<html>
<head>
<meta charset="ISO-8859-1">
<link rel="stylesheet" type="text/css" href="/emds_sso/js/datatables.min.css">
<link href="/emds_sso/js/fontawesome-free-5.12.0-web/css/all.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="/emds_sso/js/datatables.min.js"></script>


<title>Manage User Accounts</title>
</head>
<body>
<span>Insert Navigation Menu Here</span>

<h1 id="manageAccountListHeader">Manage User Accounts</h1>

<h1 id="viewUserHeader" style="display: none;">Edit User<div id='xuid'></div></h1>

<table id="manageAccountList" class="display" style="width:100%">
        <thead>
            <tr>
            	<th>Edit</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>User ID</th>
                <th>Organization</th>
                <th>Sub Organization</th>
                <th>SIPR Email Address</th>
            	<th>PCC</th>
            	<th>Active User</th>

            </tr>
        </thead>
        <tfoot>
            <tr>
            	<th>Edit</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>User ID</th>
                <th>Organization</th>
                <th>Sub Organization</th>
                <th>SIPR Email Address</th>
            	<th>PCC</th>
            	<th>Active User</th>
            </tr>
        </tfoot>
    </table>
<script>
function toggleView(foo) {
	if(foo) {
		document.getElementById("manageAccountList_wrapper").style.display = "none";
		document.getElementById("manageAccountListHeader").style.display = "none";
		document.getElementById("viewUserHeader").style.display = "block";
	}
	else {
		document.getElementById("manageAccountList_wrapper").style.display = "block";
		document.getElementById("manageAccountListHeader").style.display = "block";
		document.getElementById("viewUserHeader").style.display = "none";
	}
}
	
/**
 * Function switch view
 */

function manageUserView(row) {
 	var data=JSON.parse(decodeURIComponent(row));
	toggleView(true);
	console.log("row data=",data);
}

var table = null;
$(document).ready(function() {
	// Setup - add a text input to each footer cell
    $('#manageAccountList thead th').each( function () {
        var title = $(this).text();
        if(title !== 'Edit'){
        	$(this).html( '<div><div>' + title + '</div><input type="text" placeholder="Search '+title+'" /></div>' );
        }
        
    } );
	
	table = $('#manageAccountList').DataTable( {
        "ajax": '/emds_sso/mockapi/users.json',
//         "dataSrc" : (json) => {
//         	console.log(json);
        	
//         },
        "columns": [
        	{ "data": "uid",
        	  "render": function ( data, type, row, meta ) {
        		  console.log("render delete...data, type, row, meta",data, type, row, meta, row.uid);
			      return '<a  href="javascript:void(0);" onclick="manageUserView(\'' + encodeURIComponent(JSON.stringify(row)) + '\')"><i class="far fa-edit"></i></a>';
			    }},
            { "data": "firstName" },
            { "data": "lastName" },
            { "data": "username" },
            { "data": "organization" },
            { "data": "subOrganization" },
            { "data": "siprEmail" },
            { "data": "siprtTokenPCC" },
            { "data": "active" }
          ]
    } );

	 // Apply the search
    table.columns().every( function () {
        var that = this;
 
        $( 'input', this.header() ).on( 'keyup change clear', function () {
            if ( that.search() !== this.value ) {
                that
                    .search( this.value )
                    .draw();
            }
        } );
    } );   
    
} );

/**
 * Function to refresh the list
 */
const refreshManageAccountList = (data, textStatus) => { 
	table.ajax.reload();
}


</script>
</body>
</html>